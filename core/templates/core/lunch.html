{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="max-w-6xl mx-auto pb-20 animate-fade-in-down px-3 md:px-4">

    <div class="mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
        <div class="w-full md:w-auto text-center md:text-left">
            <a href="{% url 'home' %}" class="text-gray-500 hover:text-indigo-600 text-sm font-bold flex items-center justify-center md:justify-start gap-1 mb-2">
                <i data-lucide="arrow-left" class="w-4 h-4"></i> Quay lại Trang chủ
            </a>
            <h1 class="text-2xl md:text-3xl font-bold text-gray-800 flex items-center justify-center md:justify-start gap-3">
                <span class="bg-orange-100 text-orange-600 p-2 rounded-xl"><i data-lucide="utensils" class="w-6 h-6 md:w-8 md:h-8"></i></span>
                Hôm nay ăn gì?
            </h1>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 md:gap-8 mb-16">
        
        <div class="lg:col-span-5 space-y-4 md:space-y-6">
            
            <div class="bg-white p-4 md:p-6 rounded-2xl md:rounded-3xl shadow-sm border border-gray-100 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-20 h-20 bg-orange-50 rounded-bl-full -mr-4 -mt-4"></div>
                <h3 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <i data-lucide="shuffle" class="w-5 h-5 text-orange-500"></i> Tạo Menu Ngẫu Nhiên
                </h3>
                <div class="flex gap-3 flex-col sm:flex-row">
                    <div class="relative flex-1">
                        <input type="number" id="random-count" min="1" max="100" value="10" class="w-full pl-3 pr-10 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-orange-200 font-bold text-gray-700" placeholder="Số lượng">
                        <span class="absolute right-3 top-3.5 text-xs text-gray-400 font-bold">MÓN</span>
                    </div>
                    <button onclick="fillRandomMenu()" class="w-full sm:w-auto bg-orange-500 hover:bg-orange-600 text-white font-bold px-4 py-3 rounded-xl transition shadow-lg shadow-orange-200 flex items-center justify-center gap-2">
                        <i data-lucide="wand-2" class="w-5 h-5"></i> <span class="whitespace-nowrap">Lấy món</span>
                    </button>
                </div>
            </div>

            <div class="bg-white p-4 md:p-6 rounded-2xl md:rounded-3xl shadow-sm border border-gray-100 h-[320px] md:h-[400px] flex flex-col">
                <div class="flex justify-between items-center mb-2">
                    <label class="font-bold text-gray-800 text-sm">Danh sách quay:</label>
                    <span id="item-count" class="bg-gray-100 text-gray-500 text-xs px-2 py-1 rounded font-bold">0 món</span>
                </div>
                <textarea id="menu-input" class="flex-1 w-full bg-gray-50 border border-gray-200 rounded-xl p-3 md:p-4 text-sm font-medium text-gray-700 focus:ring-2 focus:ring-indigo-100 transition resize-none leading-loose" placeholder="Nhập món ăn... (xuống dòng để thêm món mới)"></textarea>
                <div class="flex justify-between items-center mt-3">
                    <button onclick="clearMenu()" class="text-xs text-red-500 font-bold hover:underline p-2">Xóa hết</button>
                    <button onclick="updateWheelData()" class="text-xs bg-indigo-50 text-indigo-600 px-4 py-2 rounded-lg font-bold hover:bg-indigo-100 transition">Cập nhật &rarr;</button>
                </div>
            </div>
        </div>

        <div class="lg:col-span-7">
            <div class="bg-gradient-to-br from-indigo-950 via-purple-900 to-indigo-900 rounded-[2rem] md:rounded-[3rem] p-4 md:p-8 text-center text-white relative overflow-hidden shadow-2xl h-full flex flex-col justify-center items-center border-4 border-indigo-800/50">
                <div class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-10 mix-blend-soft-light"></div>
                
                <div id="result-box" class="hidden mb-6 md:mb-8 animate-bounce-in relative z-30 w-full max-w-sm md:max-w-none">
                    <div class="bg-white text-gray-900 px-4 py-4 md:px-10 md:py-6 rounded-2xl md:rounded-3xl shadow-lg border-4 border-yellow-400 mx-auto">
                        <h2 id="final-result" class="text-2xl md:text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-orange-600 to-red-600 leading-tight break-words">???</h2>
                    </div>
                </div>

                <div class="relative w-[280px] h-[280px] sm:w-[350px] sm:h-[350px] md:w-[420px] md:h-[420px] mb-8 md:mb-10 group z-10 transition-all duration-300">
                    <div class="absolute -top-5 md:-top-7 left-1/2 -translate-x-1/2 z-30 filter drop-shadow-lg">
                         <div class="w-0 h-0 border-l-[15px] md:border-l-[20px] border-l-transparent border-r-[15px] md:border-r-[20px] border-r-transparent border-t-[30px] md:border-t-[40px] border-t-yellow-500"></div>
                    </div>
                    <div class="absolute inset-0 rounded-full bg-gradient-to-b from-yellow-300 to-yellow-600 border-[8px] md:border-[12px] border-yellow-500 overflow-hidden"></div>
                    <div id="wheel-circle" class="absolute top-2 left-2 right-2 bottom-2 md:top-3 md:left-3 md:right-3 md:bottom-3 rounded-full overflow-hidden transition-transform duration-[5000ms] cubic-bezier(0.15, 0, 0.15, 1) border-4 border-white/10"></div>
                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-16 h-16 md:w-24 md:h-24 rounded-full bg-gradient-to-br from-yellow-300 via-yellow-500 to-orange-500 flex items-center justify-center z-20 border-4 border-yellow-200/50">
                        <div class="bg-white/90 p-2 md:p-3 rounded-full shadow-inner"><i data-lucide="utensils-crossed" class="w-5 h-5 md:w-8 md:h-8 text-orange-600"></i></div>
                    </div>
                </div>

                <button id="btn-spin" onclick="startSpin()" class="relative z-20 w-full sm:w-auto bg-gradient-to-r from-yellow-400 to-orange-500 hover:from-yellow-300 text-yellow-950 font-black text-lg md:text-xl px-6 py-4 md:px-14 md:py-5 rounded-xl md:rounded-full shadow-lg hover:-translate-y-1 transition-all flex items-center justify-center gap-3 border-b-4 border-orange-700 active:border-b-0">
                    <span>QUAY NGAY</span> <i data-lucide="play" class="w-5 h-5 md:w-6 md:h-6 fill-current"></i>
                </button>
            </div>
        </div>
    </div>

    {% if db_restaurants %}
    <div id="partner-section" class="border-t border-gray-100 pt-8 md:pt-10 mb-12 scroll-mt-20 md:scroll-mt-24">
        <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3 mb-6">
            <h2 class="text-xl md:text-2xl font-bold text-gray-800 flex items-center gap-2">
                <span class="bg-yellow-100 text-yellow-600 p-2 rounded-lg"><i data-lucide="crown" class="w-5 h-5"></i></span>
                Quán Nổi Bật
            </h2>
            <span class="text-[10px] font-bold bg-gradient-to-r from-red-500 to-orange-500 text-white px-2 py-1 rounded uppercase tracking-wider shadow-sm">Được đề xuất</span>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6">
            {% for res in db_restaurants %}
            <a href="{{ res.url_foody|default:'#' }}" target="_blank" class="group bg-white border-2 border-orange-100 rounded-2xl overflow-hidden hover:shadow-xl hover:-translate-y-1 transition-all duration-300 block relative ring-4 ring-transparent hover:ring-orange-50">
                <div class="relative aspect-[4/3] overflow-hidden bg-gray-100">
                    {% if res.image %}
                        <img src="{{ res.image.url }}" class="w-full h-full object-cover group-hover:scale-110 transition duration-700">
                    {% else %}
                        <div class="w-full h-full flex flex-col items-center justify-center text-gray-400">
                            <i data-lucide="image-off" class="w-8 h-8 mb-1"></i><span class="text-xs">Chưa có ảnh</span>
                        </div>
                    {% endif %}
                    <div class="absolute top-3 right-3 bg-yellow-400 text-yellow-900 text-xs font-black px-2.5 py-1 rounded-lg shadow-sm flex items-center gap-1">{{ res.rating }} <i data-lucide="star" class="w-3 h-3 fill-current"></i></div>
                    <div class="absolute top-3 left-3 bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded shadow-sm flex items-center gap-1"><i data-lucide="award" class="w-3 h-3"></i> Partner</div>
                </div>
                <div class="p-4 bg-gradient-to-b from-white to-orange-50/30">
                    <h4 class="font-bold text-gray-800 text-base md:text-lg truncate group-hover:text-orange-600 transition" title="{{ res.name }}">{{ res.name }}</h4>
                    <p class="text-sm text-gray-500 truncate mt-1 flex items-center gap-1"><i data-lucide="map-pin" class="w-3 h-3 flex-shrink-0 text-orange-400"></i> {{ res.address }}</p>
                    <div class="border-t border-orange-100 mt-3 pt-3 flex justify-between items-center text-xs">
                        <span class="text-orange-600 flex items-center gap-1 font-bold bg-orange-100 px-2 py-1 rounded"><i data-lucide="thumbs-up" class="w-3 h-3"></i> Uy tín</span>
                        <span class="bg-gray-100 text-gray-600 px-2 py-1 rounded font-medium truncate max-w-[100px]">{{ res.category }}</span>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>

        {% if db_restaurants.has_other_pages %}
        <div class="flex justify-center gap-2 mt-6">
            {% if db_restaurants.has_previous %}
                <a href="?{{ base_params }}&page_db={{ db_restaurants.previous_page_number }}&page_api={{ api_restaurants.number }}#partner-section" class="px-3 py-2 bg-white border rounded-lg hover:bg-orange-50 text-gray-600 font-bold text-sm shadow-sm transition">← Trước</a>
            {% endif %}
            
            <span class="px-3 py-2 bg-orange-100 text-orange-600 rounded-lg font-bold text-sm shadow-inner">Trang {{ db_restaurants.number }}</span>

            {% if db_restaurants.has_next %}
                <a href="?{{ base_params }}&page_db={{ db_restaurants.next_page_number }}&page_api={{ api_restaurants.number }}#partner-section" class="px-3 py-2 bg-white border rounded-lg hover:bg-orange-50 text-gray-600 font-bold text-sm shadow-sm transition">Sau →</a>
            {% endif %}
        </div>
        {% endif %}
    </div>
    {% endif %}

    <div id="nearby-section" class="border-t border-gray-100 pt-8 md:pt-10 scroll-mt-20 md:scroll-mt-24">
        <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-4 mb-6 md:mb-8">
            <h2 class="text-xl md:text-2xl font-bold text-gray-800 flex items-center gap-2">
                <span class="bg-blue-100 text-blue-600 p-2 rounded-lg"><i data-lucide="radar" class="w-5 h-5"></i></span>
                Quán ngon gần đây
            </h2>

            <div class="bg-gray-50 p-3 rounded-2xl flex flex-col sm:flex-row items-center gap-3 sm:gap-4 border border-gray-200 shadow-sm w-full lg:w-auto">
                <div class="flex items-center gap-2 text-sm text-gray-600 font-bold whitespace-nowrap w-full sm:w-auto justify-between sm:justify-start">
                    <span class="flex items-center gap-2"><i data-lucide="radius" class="w-4 h-4 text-indigo-500"></i> Bán kính:</span>
                    <span id="radius-display" class="text-indigo-600">{{ current_radius }}m</span>
                </div>
                <input type="range" id="radius-slider" min="500" max="5000" step="100" value="{{ current_radius }}" 
                    class="w-full sm:w-32 md:w-48 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"
                    oninput="updateRadiusLabel(this.value)">
                <button onclick="applyFilter()" class="w-full sm:w-auto bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-bold px-4 py-2.5 rounded-xl transition shadow-md">
                    Tìm kiếm
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6">
            {% for res in api_restaurants %}
            <a href="{{ res.url_foody|default:'#' }}" target="_blank" class="group bg-white border border-gray-100 rounded-2xl overflow-hidden hover:shadow-lg hover:-translate-y-1 transition-all duration-300 block relative">
                <div class="relative aspect-[4/3] overflow-hidden bg-gray-100">
                    <img src="{{ res.image.url }}" class="w-full h-full object-cover group-hover:scale-110 transition duration-700">
                    <div class="absolute top-3 right-3 bg-green-500 text-white text-xs font-bold px-2.5 py-1 rounded-lg shadow-sm flex items-center gap-1">{{ res.rating }} <i data-lucide="star" class="w-3 h-3 fill-current"></i></div>
                    <div class="absolute top-3 left-3 bg-white/90 backdrop-blur text-blue-600 text-[10px] font-bold px-2 py-0.5 rounded shadow-sm flex items-center gap-1"><i data-lucide="globe" class="w-3 h-3"></i> Geoapify</div>
                </div>
                <div class="p-4">
                    <h4 class="font-bold text-gray-800 text-base truncate group-hover:text-blue-600 transition" title="{{ res.name }}">{{ res.name }}</h4>
                    <p class="text-xs text-gray-500 truncate mt-1 flex items-center gap-1"><i data-lucide="map-pin" class="w-3 h-3 flex-shrink-0"></i> {{ res.address }}</p>
                    <div class="border-t border-gray-50 mt-3 pt-3 flex justify-between items-center text-xs">
                        <span class="text-gray-500 flex items-center gap-1 font-medium"><i data-lucide="users" class="w-3 h-3"></i> {{ res.review_count }} đánh giá</span>
                        <span class="bg-gray-100 text-gray-600 px-2 py-0.5 rounded font-medium truncate max-w-[100px]">{{ res.category }}</span>
                    </div>
                </div>
            </a>
            {% empty %}
             <div class="col-span-1 sm:col-span-2 lg:col-span-4 py-16 text-center border-2 border-dashed border-gray-200 rounded-3xl bg-gray-50/50">
                <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mx-auto mb-3 shadow-sm"><i data-lucide="search-x" class="w-8 h-8 text-gray-300"></i></div>
                <h3 class="text-gray-900 font-bold">Không tìm thấy quán nào quanh đây</h3>
                <p class="text-gray-500 text-sm mt-1">Hãy thử tăng bán kính hoặc kiểm tra lại kết nối mạng.</p>
            </div>
            {% endfor %}
        </div>

        {% if api_restaurants.has_other_pages %}
        <div class="flex justify-center gap-2 mt-6 pb-10">
            {% if api_restaurants.has_previous %}
                <a href="?{{ base_params }}&page_api={{ api_restaurants.previous_page_number }}&page_db={{ db_restaurants.number }}#nearby-section" class="px-3 py-2 bg-white border rounded-lg hover:bg-blue-50 text-gray-600 font-bold text-sm shadow-sm transition">← Trước</a>
            {% endif %}
            
            <span class="px-3 py-2 bg-blue-100 text-blue-600 rounded-lg font-bold text-sm shadow-inner">Trang {{ api_restaurants.number }}</span>

            {% if api_restaurants.has_next %}
                <a href="?{{ base_params }}&page_api={{ api_restaurants.next_page_number }}&page_db={{ db_restaurants.number }}#nearby-section" class="px-3 py-2 bg-white border rounded-lg hover:bg-blue-50 text-gray-600 font-bold text-sm shadow-sm transition">Sau →</a>
            {% endif %}
        </div>
        {% endif %}
    </div>

</div>

<script>
    // 1. DATA VÒNG QUAY
    const masterMenu = [
        "Cơm tấm sườn bì chả", "Cơm gà xối mỡ", "Cơm gà luộc", "Cơm sườn nướng", "Cơm thịt kho trứng", 
        "Cơm cá kho tộ", "Cơm bò lúc lắc", "Cơm gà rô ti", "Cơm chiên dương châu", "Cơm chiên hải sản", 
        "Cơm gà teriyaki", "Cơm cà ri gà", "Cơm heo quay", "Cơm vịt quay", "Cơm cá basa kho", 
        "Cơm gà sốt tiêu đen", "Cơm bò xào hành tây", "Cơm trứng chiên – canh", "Cơm sườn ram mặn", 
        "Cơm chay (đậu hũ – rau xào)", "Phở bò", "Phở gà", "Bún bò Huế", "Bún riêu cua", "Bún chả", 
        "Bún thịt nướng", "Bún mắm", "Mì Quảng", "Hủ tiếu Nam Vang", "Hủ tiếu khô", "Mì xào hải sản", 
        "Mì xào bò", "Miến gà", "Miến xào", "Bún mọc", "Bún cá", "Bún tôm", "Canh bún", "Phở xào", "Mì trộn",
        "Bánh mì thịt", "Bánh mì chảo", "Bánh mì xíu mại", "Bánh cuốn", "Bánh ướt lòng gà", "Xôi mặn", 
        "Xôi gà", "Hamburger", "Sandwich trứng", "Sandwich gà", "Pizza miếng", "Gà rán", "Mì ly", "Cháo gà", 
        "Cháo sườn", "Súp cua", "Nui xào", "Nui nước", "Bánh bao", "Bánh đa cua", "Salad ức gà", "Salad cá ngừ", 
        "Cơm gạo lứt + thịt nướng", "Cơm gạo lứt + cá áp chảo", "Bún trộn", "Phở cuốn", "Gỏi cuốn", "Gỏi gà", 
        "Cá hấp", "Cá kho + rau luộc", "Đậu hũ sốt cà", "Canh rong biển + cơm", "Trứng luộc + salad", 
        "Trứng chiên ít dầu", "Ức gà áp chảo", "Thịt luộc chấm mắm", "Canh chua cá", "Canh khổ qua nhồi thịt", 
        "Lẩu 1 người", "Cơm chay thập cẩm", "Cơm trộn Hàn Quốc", "Tokbokki", "Kimbap", "Mì cay", "Mì udon", 
        "Cơm Nhật (bento)", "Sushi cuộn", "Ramen", "Mì Ý sốt bò bằm", "Mì Ý hải sản", "Cơm chiên Thái", 
        "Pad Thai", "Cơm gà Hải Nam", "Lẩu Thái mini", "Mì Singapore", "Cơm chiên cá mặn", "Cháo cá", 
        "Bún đậu mắm tôm", "Bún chả cá", "Cơm canh gia đình"
    ];

    const menuInput = document.getElementById('menu-input');
    const wheelCircle = document.getElementById('wheel-circle');
    const resultBox = document.getElementById('result-box');
    const finalResult = document.getElementById('final-result');
    const btnSpin = document.getElementById('btn-spin');
    const itemCountSpan = document.getElementById('item-count');

    let currentItems = [];
    let isSpinning = false;

    function fillRandomMenu() {
        let count = parseInt(document.getElementById('random-count').value);
        if (count > 100) count = 100; if (count < 1) count = 1;
        const shuffled = [...masterMenu].sort(() => 0.5 - Math.random());
        const selected = shuffled.slice(0, count);
        menuInput.value = selected.join('\n');
        updateWheelData();
    }

    function clearMenu() {
        menuInput.value = '';
        updateWheelData();
    }

    function updateWheelData() {
        const text = menuInput.value.trim();
        if (!text) {
            currentItems = [];
        } else {
            currentItems = text.split('\n').map(item => item.trim()).filter(item => item !== '');
        }
        if(itemCountSpan) itemCountSpan.innerText = `${currentItems.length} món`;
        renderWheel();
    }

    function renderWheel() {
        wheelCircle.innerHTML = ''; 
        resultBox.classList.add('hidden');
        wheelCircle.style.transform = 'rotate(0deg)';

        if (currentItems.length === 0) {
            wheelCircle.style.background = '#2d3748';
            return;
        }

        const sliceAngle = 360 / currentItems.length;
        const colors = ['#ef4444', '#f97316', '#f59e0b', '#84cc16', '#10b981', '#06b6d4', '#3b82f6', '#8b5cf6', '#d946ef', '#f43f5e'];

        currentItems.forEach((item, index) => {
            const rotate = index * sliceAngle;
            const divider = document.createElement('div');
            divider.className = 'absolute top-0 left-1/2 w-0.5 h-1/2 bg-white/30 origin-bottom z-10';
            divider.style.transform = `translateX(-50%) rotate(${rotate}deg)`;
            wheelCircle.appendChild(divider);
            
            const textEl = document.createElement('div');
            // Mobile: text-[10px], Desktop: text-xs
            textEl.className = 'absolute top-1/2 left-1/2 text-white font-black text-[10px] md:text-xs uppercase origin-[0%_0%] whitespace-nowrap pt-1 pl-5 z-20 drop-shadow-sm';
            textEl.style.transform = `rotate(${rotate + sliceAngle/2 - 90}deg) translate(24px, -50%)`;
            textEl.style.width = '42%';
            textEl.innerText = item.length > 18 ? item.substring(0, 18) + '..' : item;
            wheelCircle.appendChild(textEl);
        });

        const gradientParts = currentItems.map((_, index) => {
            const color = colors[index % colors.length];
            const start = index * (100 / currentItems.length);
            const end = (index + 1) * (100 / currentItems.length);
            return `${color} ${start}% ${end}%`;
        });
        wheelCircle.style.background = `conic-gradient(${gradientParts.join(', ')})`;
    }

    function startSpin() {
        if (currentItems.length === 0) {
            alert("Bạn chưa nhập món ăn nào!"); return;
        }
        if (isSpinning) return;

        isSpinning = true;
        btnSpin.disabled = true;
        resultBox.classList.add('hidden');
        btnSpin.classList.add('opacity-70', 'cursor-not-allowed', 'brightness-90'); 
        btnSpin.innerHTML = '<span>ĐANG QUAY...</span><i data-lucide="loader-2" class="w-6 h-6 animate-spin"></i>';
        lucide.createIcons();

        const minSpin = 3600; 
        const randomDegree = Math.floor(Math.random() * 360);
        const totalDegree = minSpin + randomDegree;

        wheelCircle.style.transform = `rotate(${totalDegree}deg)`;

        setTimeout(() => {
            isSpinning = false;
            btnSpin.disabled = false;
            btnSpin.classList.remove('opacity-70', 'cursor-not-allowed', 'brightness-90');
            btnSpin.innerHTML = '<span>QUAY LẠI</span><i data-lucide="rotate-cw" class="w-6 h-6"></i>';
            lucide.createIcons();
            const actualDeg = totalDegree % 360;
            const sliceAngle = 360 / currentItems.length;
            const winningIndex = Math.floor((360 - actualDeg) / sliceAngle) % currentItems.length;
            finalResult.innerText = currentItems[winningIndex];
            resultBox.classList.remove('hidden');
        }, 5000);
    }

    if(menuInput) {
        menuInput.addEventListener('input', updateWheelData);
        fillRandomMenu(); 
    }

    // 2. LOGIC TÌM KIẾM
    function updateRadiusLabel(val) {
        const display = document.getElementById('radius-display');
        if(display) display.innerText = val + 'm';
    }

    function applyFilter() {
        const slider = document.getElementById('radius-slider');
        const radius = slider ? slider.value : 1000;
        const urlParams = new URLSearchParams(window.location.search);
        urlParams.set('radius', radius);
        window.location.search = urlParams.toString();
    }

    // 3. AUTO GET LOCATION
    document.addEventListener("DOMContentLoaded", function() {
        if(typeof lucide !== 'undefined') lucide.createIcons();

        const urlParams = new URLSearchParams(window.location.search);
        const hasLat = urlParams.has('lat');

        if (!hasLat) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        const currentRadius = document.getElementById('radius-slider') ? document.getElementById('radius-slider').value : 1000;
                        window.location.search = `?lat=${lat}&lon=${lon}&radius=${currentRadius}`;
                    },
                    function(error) {
                        console.log("User denied location or Error: ", error.message);
                    }
                );
            }
        }
    });
</script>

<style>
    @keyframes bounceIn {
        0% { opacity: 0; transform: scale(0.3) translateY(-20px); }
        50% { opacity: 1; transform: scale(1.05) translateY(0); }
        70% { transform: scale(0.95); }
        100% { transform: scale(1); }
    }
    .animate-bounce-in { animation: bounceIn 0.6s cubic-bezier(0.215, 0.610, 0.355, 1.000); }
    html {
        scroll-behavior: smooth;
    }
</style>
{% endblock %}